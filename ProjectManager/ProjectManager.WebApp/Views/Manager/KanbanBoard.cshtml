@model ProjectManager.WebApp.Models.KanbanBoardViewModel

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>Kanban Board</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1">
            @Html.Label("Filters")
        </div>
        @*TODO: Add class "filters" *@
        <div class="col-md-11">
            <a href="#">
                Only High Priority
            </a>
            <a href="#">
                Assigned to me
            </a>
            <a href="#">
                Recently updated
            </a>
        </div>
    </div>
    <div class="row">
        @foreach (var status in Model.Stasuses.Where(status => status.Text != "Backlog"))
        {
            <div class="col-md-3">
                @Html.Label(status.Text)
                @foreach (var assignment in Model.Assignments.Where(assign => assign.Status.Description == status.Text))
                {
                    <div class="assignment">
                        @Html.Label(assignment.Name)
                        <br/>
                        @assignment.Description
                        <br/>
                        @if (assignment.AssignedTo != null)
                        {
                            <a data-assignmentid="@assignment.Id" class="popup-button" href="">Assigned to: @assignment.AssignedTo.UserName</a>
                        }
                        else
                        {
                            <a data-assignmentid="@assignment.Id" class="popup-button" href="#">
                                Unassigned
                            </a>
                        }
                    </div>
                }
            </div>
        }
    </div>
</div>

<!-- przenieść gdzieś-->
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

<div id="dialog" title="Assign user to project" class="popup-dialog">
    @foreach (var user in Model.Users)
    {
        <div class="col-md-6">
            @user.UserName
        </div>
        <a data-userid="@user.Id" class="col-md-6 assign-user" href="">
            Assign user
        </a>
    }
    <a class="col-md-12 assign-user" href="">
        Cancel assignment
    </a>
    <button id="CancelPopup" class="btn margin-top-10px col-md-6">Cancel</button>
</div>

<script>

    var currentAssignmentId;

    $(function () {
        $("#dialog").dialog({
            autoOpen: false,
            resizable: false,
            draggable: false,
            open: function (event, ui) { $(".ui-dialog-titlebar-close", ui.dialog | ui).hide(); }
        });
        $(".popup-button").click(function (e) {
            e.preventDefault();
            currentAssignmentId = $(this).attr("data-assignmentid");
            $("#dialog").dialog("open");
        });
    });

    $("#CancelPopup").click(function (e) {
        $("#dialog").dialog("close");
    });

    $(".assign-user").click(function (e) {
        var userId = $(this).attr("data-userid");

            $.ajax({
                type: "POST",
                url: '@Url.Action("ChangeCurrentAssignment", "Manager")',
                data: { userId: userId, currentAssignmentId: currentAssignmentId },
                datatype: "JSON",
                success: function (data) {
                    location.reload();
                },
                error: function () {
                    alert("Failed to get data from server");
                }
            });
    });
</script>